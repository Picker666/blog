(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{424:function(t,s,a){"use strict";a.r(s);var e=a(54),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"dns-prefetch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns-prefetch"}},[t._v("#")]),t._v(" dns-Prefetch")]),t._v(" "),a("h2",{attrs:{id:"dns-优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns-优化"}},[t._v("#")]),t._v(" DNS 优化")]),t._v(" "),a("ul",[a("li",[t._v("减少DNS请求次数；")]),t._v(" "),a("li",[t._v("缩短DNS解析的时间 -- dns-prefetch")])]),t._v(" "),a("h2",{attrs:{id:"关于dns-prefetch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于dns-prefetch"}},[t._v("#")]),t._v(" 关于dns-prefetch")]),t._v(" "),a("p",[t._v("dns-prefetch(DNS预获取)是前端网络性能优化的一种措施。")]),t._v(" "),a("p",[t._v("它根据浏览器定义的规则，提前解析之后"),a("strong",[t._v("可能")]),t._v("会用到的域名，使解析结果缓存到系统缓存中，缩短DNS解析时间，进而提高网站的访问速度。")]),t._v(" "),a("p",[t._v("但是 dns 缓存的时间是有限的")]),t._v(" "),a("p",[t._v("系统")]),t._v(" "),a("ul",[a("li",[t._v("Windows 默认值是 MaxCacheTTL，86400s，也就是一天；")]),t._v(" "),a("li",[t._v("macOS 严格遵循DNS协议中的TTL。")])]),t._v(" "),a("p",[t._v("浏览器：")]),t._v(" "),a("p",[t._v("浏览器也会缓存DNS记录, 但是浏览器DNS缓存时间跟TTL无关，每种浏览器都有一个固定值。")]),t._v(" "),a("ul",[a("li",[t._v("Chrome 对每个域名会默认缓存60s；")]),t._v(" "),a("li",[t._v("IE DNS缓存30min；")]),t._v(" "),a("li",[t._v("Firefox 默认缓存时间只有1分钟，可以通过修改该默认值加快DNS解析速度；\n"),a("ul",[a("li",[t._v("打开一个新的窗口，地址栏输 入 about:config，回车，进入设置界面。然后搜索 network.dnsCacheExpiration ，把原来的60改成6000（表示缓存6000秒），再搜索network.dnsCacheEntries 把默认的20改成1000（表示缓存1000条）。如果没有上面两个项目，新建它们即可，新建条目类型为整数型。 当然也可以按照需要设置成其它的值。")])])]),t._v(" "),a("li",[t._v("afari 约 10s。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("TTL(Time-To-Live)，就是一条域名解析记录在DNS服务器中的存留时间")]),t._v(" "),a("p",[t._v("浏览器DNS缓存的时间跟DNS服务器返回的TTL值无关, 它的缓存时间取决于浏览器自身设置。")]),t._v(" "),a("p",[t._v("系统缓存会参考DNS服务器响应的TTL值，但是不完全等于TTL值。")]),t._v(" "),a("p",[t._v("国内和国际上很多平台的TTL值都是以秒为单位的，很多的默认值都是3600，也就是默认缓存1小时。")])]),t._v(" "),a("h2",{attrs:{id:"dns-prefetch-是如何优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns-prefetch-是如何优化"}},[t._v("#")]),t._v(" dns-prefetch 是如何优化")]),t._v(" "),a("p",[t._v("每当浏览器从（第三方）服务器发送一次请求时，都要先通过DNS解析将该跨域域名解析为 IP地址，然后浏览器才能发出请求。每次的DNS解析都会花时间的，并且这部分时间什么也干不了。")]),t._v(" "),a("p",[t._v("如果同一时间内，有多个请求都发送给同一个服务器，那么DNS解析会多次并且重复触发。这样会导致整体的网页加载有延迟的情况。虽然DNS解析占用不了多大带宽，但是它会产生很高的延迟，尤其是对于移动网络会更为明显。")]),t._v(" "),a("p",[t._v("dns-prefetch 预解析技术，是在请求连接之前进行查询，并缓存，一方面避免了请求连接时候再次DNS查询，另一方面，避免并发多个相同请求造成重复域名解析。")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("dns-prefetch最大的缺点就是使用它太多,对网络是一种负担。")])]),t._v(" "),a("h2",{attrs:{id:"dns-prefetch-过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns-prefetch-过程"}},[t._v("#")]),t._v(" dns-prefetch 过程")]),t._v(" "),a("p",[t._v("当浏览器访问一个域名的时候，需要解析一次DNS，获得对应域名的ip地址。 在解析过程中，按照:")]),t._v(" "),a("ul",[a("li",[t._v("浏览器缓存")]),t._v(" "),a("li",[t._v("系统缓存 -- 缓存之后DNS解析时间可以低至0-1m；")]),t._v(" "),a("li",[t._v("路由器缓存 -- 缓存后的解析时间最小也要约15ms；")]),t._v(" "),a("li",[t._v("ISP(运营商)DNS缓存 -- 缓存后解析时间在80-120ms，不常见的域名，平均需要200-300ms；")]),t._v(" "),a("li",[t._v("根域名服务器")]),t._v(" "),a("li",[t._v("顶级域名服务器")]),t._v(" "),a("li",[t._v("主域名服务器")])]),t._v(" "),a("p",[t._v("dns-prefetch 相当于在浏览器缓存之后，在本地操作系统中做了DNS缓存。")]),t._v(" "),a("p",[t._v("从第二步之后已经不受我们控制，时间大概是 15 - 300ms，也就是使用 dns-prefetch 后续的解析步骤就不用执行了，可以带来 15 - 300ms 时间上的优化。")]),t._v(" "),a("h2",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),a("p",[t._v("DNS Prefetch 应该尽量的放在网页的前面，推荐放在 "),a("code",[t._v('<meta charset="UTF-8">')]),t._v(" 后面。")]),t._v(" "),a("p",[t._v("开始是为了适配  https  和   http  。就是当前请求链接是https ，那么这个//前面自动补充https ，反则补充http 。")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dns-prefetch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("//www.baidu.com.cn/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[t._v("1、对静态资源域名做手动dns prefetching。")]),t._v(" "),a("li",[t._v("2、对js里会发起的跳转、请求做手动dns prefetching。")]),t._v(" "),a("li",[t._v("3、不用对超链接(a标签的hre)做手动dns prefetching，因为chrome会自动做dns prefetching。")]),t._v(" "),a("li",[t._v("4、dns-prefetch 仅对跨域域上的 DNS查找有效，因此请避免使用它来指向相同域")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("手动dns prefetching的代码实际上还是会增加html的代码量的，特别是域名多的情况下")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("考虑将 dns-prefetch 与 preconnect(预连接)提示配对。")]),t._v(" "),a("p",[t._v("如果站点是通过HTTPS服务的，两者的组合会涵盖DNS解析，建立TCP连接以及执行TLS握手。将两者结合起来可提供进一步减少跨域请求的感知延迟的机会。如下所示：")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("preconnect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://fonts.gstatic.com/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("crossorigin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("dns-prefetch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://fonts.gstatic.com/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("如果页面需要建立与许多第三方域的连接，则将它们预先连接会适得其反。 preconnect 提示最好仅用于最关键的连接。对于其他的，只需使用 "),a("code",[t._v('<link rel="dns-prefetch">')]),t._v(" 即可节省第一步的时间DNS查找")])]),t._v(" "),a("p",[t._v("dns缓存前：\n"),a("img",{attrs:{src:"/blog/images/base/dnsPrefetch1.png",alt:"dns缓存前"}})]),t._v(" "),a("p",[t._v("dns缓存后：\n"),a("img",{attrs:{src:"/blog/images/base/dnsPrefetch2.png",alt:"dns缓存后"}})])])}),[],!1,null,null,null);s.default=n.exports}}]);